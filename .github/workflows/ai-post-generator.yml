name: AI Post Generator (Free X Copy)

on:
  schedule:
    # UTC 0:00 = 日本時間 9:00
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Generate text
        id: gen
        run: |
          THEMES=("新規事業" "マーケ施策" "プロダクト改善")
          THEME=${THEMES[$RANDOM % 3]}
          TITLE="企画×AI活用（${THEME}）：$(date +%Y%m%d)"
          FULL_BODY="企画業務では、AIを情報整理と選択肢生成に使うと効果的です。発散と収束を分け、評価軸を先に定義することで、企画の質とスピードが向上します。"

          # 280文字以内に短縮
          python - << 'EOF'
import textwrap, os
full_text = os.environ["FULL_BODY"]
short_text = textwrap.shorten(full_text, width=280, placeholder="…")
print(f"SHORT_BODY={short_text}")
EOF

          echo "title=$TITLE" >> $GITHUB_OUTPUT
          echo "theme=$THEME" >> $GITHUB_OUTPUT
          echo "body_short<<EOF" >> $GITHUB_OUTPUT
          echo "$short_text" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      - name: Create Issue (for manual X copy)
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: "${{ steps.gen.outputs.title }}",
              body: "${{ steps.gen.outputs.body_short }}",
              labels: ["AI","企画","${{ steps.gen.outputs.theme }}"]
            })
